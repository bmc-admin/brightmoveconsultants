name: Update Site from Framer

on:
  schedule:
    - cron: '0 0 * * 0'  # Runs weekly on Sundays
  workflow_dispatch:

jobs:
  update_site:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install WinHTTrack
        run: sudo apt-get install -y httrack

      - name: Download Framer Site
        run: |
          mkdir site
          httrack "${{ secrets.FRAMER_SITE_URL }}" -O "./site" --disable-security-limits -%v
        env:
          FRAMER_SITE_URL: ${{ secrets.FRAMER_SITE_URL }}

      - name: Remove Framer Watermark
        run: |
          # Remove the Framer badge container HTML
          find ./site -type f -name "*.html" -exec sed -i '/<div id="__framer-badge-container"><\/div>/d' {} \;
          # Remove the Framer badge CSS
          find ./site -type f -name "*.css" -exec sed -i '/#__framer-badge-container {/,/z-index: 314159/d' {} \;

      - name: Commit and Push Changes
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          git config --local user.email "your-email@example.com"
          git config --local user.name "Your Name"
          git add .
          git commit -m "Automated update of site content" || echo "No changes to commit"
          git push https://$GH_PAT@github.com/bmc-admin/brightmoveconsultants.git HEAD:main
